image: alpine/edge
environment:
  RUSTUP_OVERRIDE_BUILD_TRIPLE: x86_64-unknown-linux-musl
packages:
  - rustup
  - redis
sources:
  - https://git.sr.ht/~grauwoelfchen/fourche
tasks:
  - setup: |
      rustup-init -y \
        --default-host x86_64-unknown-linux-musl \
        --default-toolchain nightly
      source ~/.cargo/env
      rustup component add clippy rustfmt
  - check: |
      source ~/.profile
      cd fourche
      make verify:check
  - format: |
      source ~/.profile
      cd fourche
      make verify:format
  - lint: |
      source ~/.profile
      cd fourche
      make verify:lint
  - build: |
      source ~/.profile
      cd fourche
      make build
